<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>S√©lectionnez les UEs</title>

    <!-- Fonts Modernes -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Rajdhani:wght@300;500;700&display=swap"
        rel="stylesheet">

    <!-- Icons & Styles -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="css/themes.css">
    <link rel="stylesheet" href="css/device-check.css">

    <!-- Three.js pour la 3D -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
</head>

<body>

    <!-- Canvas pour l'arri√®re-plan 3D (ADN) -->
    <div id="canvas-container"></div>

    <audio id="background-music" src="assets/sounds/hospital_ambient.mp3" loop></audio>
    <audio src="assets/sounds/hospital_ambient.mp3" autoplay loop hidden>
        Votre navigateur ne prend pas en charge la music
    </audio>

    <!-- Scene overlay -->
    <div class="scene-overlay">


        <h1 class="h1">S√©lectionnez les UEs</h1>
        <a href="index.html" class="back-link-bottom"><i class="fas fa-arrow-left"></i> Retour au menu</a>
        <div class="container">
            <div class="themes-container">
                <div id="themes-grid">
                    <div class="theme-card" data-theme="Cardiologie">
                        <span class="emoji">‚ù§Ô∏è</span>
                        <h2>Cardiologie</h2>
                        <p class="theme-subtitle">Cas cliniques de cardiologie</p>
                    </div>
                    <div class="theme-card" data-theme="Uronephro">
                        <span class="emoji">üöª</span>
                        <h2>Uro-n√©phrologie</h2>
                        <p class="theme-subtitle">Pathologies urologiques et r√©nales</p>
                    </div>
                    <div class="theme-card" data-theme="Endocrinologie">
                        <span class="emoji">üß†</span>
                        <h2>Endocrinologie - Diab√©tologie - Nutrition</h2>
                        <p class="theme-subtitle">Pathologies m√©taboliques et hormonales</p>
                    </div>
                    <div class="theme-card" data-theme="Neurosensorielle">
                        <span class="emoji">üß†</span>
                        <h2>Neurosensorielle</h2>
                        <p class="theme-subtitle">Maladies des organes des sens</p>
                    </div>
                    <div class="theme-card" data-theme="A_venir">
                        <span class="emoji">üöß</span>
                        <h2>A venir ...</h2>
                        <p class="theme-subtitle">Nouveau contenu √† venir tr√®s bient√¥t</p>
                    </div>
                    <div class="theme-card" data-theme="A_venir">
                        <span class="emoji">üöß</span>
                        <h2>A venir ...</h2>
                        <p class="theme-subtitle">Nouveau contenu √† venir tr√®s bient√¥t</p>
                    </div>


                </div>
            </div>
        </div>


        <!-- Modal pour la s√©lection des motifs -->
        <div id="motifs-modal" class="motifs-modal" style="display: none;">
            <div class="motifs-content">
                <button id="close-motifs" class="close-motifs">&times;</button>
                <h2 id="motifs-title">Choisissez un cas</h2>
                <div id="motifs-actions" class="motifs-actions">
                    <button id="select-unplayed" class="secondary-btn-modal">S√©lectionner les cas non faits</button>
                </div>
                <div id="motifs-list" class="motifs-list">
                    <!-- Les motifs seront inject√©s ici par JS -->
                </div>
                <button id="start-session" class="start-session" style="display: none;">Commencer la session</button>
            </div>
        </div>
    </div>

    <!-- Script 3D Background (ADN) -->
    <script>
        /* --- LOGIQUE 3D BACKGROUND (ADN) --- */
        const init3D = () => {
            const container = document.getElementById('canvas-container');
            const scene = new THREE.Scene();
            // Ajout d'un brouillard pour la profondeur
            scene.fog = new THREE.FogExp2(0x000510, 0.002);

            const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            const renderer = new THREE.WebGLRenderer({ alpha: true, antialias: true });

            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setPixelRatio(window.devicePixelRatio);
            container.appendChild(renderer.domElement);

            // Cr√©ation des particules ADN
            const particlesGeometry = new THREE.BufferGeometry();
            const particlesCount = 700;
            const posArray = new Float32Array(particlesCount * 3);
            const colorArray = new Float32Array(particlesCount * 3);

            for (let i = 0; i < particlesCount; i++) {
                // Double helice logic
                const i3 = i * 3;
                const angle = i * 0.1;
                const radius = 3;
                const rise = i * 0.05 - 15; // Hauteur

                // Strand 1
                const x = Math.cos(angle) * radius;
                const z = Math.sin(angle) * radius;

                // Strand 2 (offset by PI)
                const x2 = Math.cos(angle + Math.PI) * radius;
                const z2 = Math.sin(angle + Math.PI) * radius;

                // On alterne entre les deux brins pour remplir le tableau
                if (i % 2 === 0) {
                    posArray[i3] = x + (Math.random() - 0.5) * 0.5;
                    posArray[i3 + 1] = rise;
                    posArray[i3 + 2] = z + (Math.random() - 0.5) * 0.5;
                    // Couleur Cyan/Bleu
                    colorArray[i3] = 0.1;
                    colorArray[i3 + 1] = 0.8;
                    colorArray[i3 + 2] = 1.0;
                } else {
                    posArray[i3] = x2 + (Math.random() - 0.5) * 0.5;
                    posArray[i3 + 1] = rise;
                    posArray[i3 + 2] = z2 + (Math.random() - 0.5) * 0.5;
                    // Couleur Violet/Rose
                    colorArray[i3] = 1.0;
                    colorArray[i3 + 1] = 0.2;
                    colorArray[i3 + 2] = 0.6;
                }
            }

            particlesGeometry.setAttribute('position', new THREE.BufferAttribute(posArray, 3));
            particlesGeometry.setAttribute('color', new THREE.BufferAttribute(colorArray, 3));

            // Texture de particule (cercle soft)
            const sprite = new THREE.TextureLoader().load('https://threejs.org/examples/textures/sprites/disc.png');

            const material = new THREE.PointsMaterial({
                size: 0.15,
                map: sprite,
                transparent: true,
                vertexColors: true,
                blending: THREE.AdditiveBlending,
                depthWrite: false
            });

            const particlesMesh = new THREE.Points(particlesGeometry, material);
            scene.add(particlesMesh);

            camera.position.z = 8;
            camera.position.y = -5;

            // Animation Loop
            const animate = () => {
                requestAnimationFrame(animate);
                particlesMesh.rotation.y += 0.003;
                particlesMesh.rotation.z += 0.001;

                // Effet de flottement cam√©ra
                const time = Date.now() * 0.0005;
                camera.position.y += Math.sin(time) * 0.01;

                renderer.render(scene, camera);
            };
            animate();

            // Resize handler
            window.addEventListener('resize', () => {
                camera.aspect = window.innerWidth / window.innerHeight;
                camera.updateProjectionMatrix();
                renderer.setSize(window.innerWidth, window.innerHeight);
            });
        };

        init3D();
    </script>

    <script src="js/themes.js?v=20251220-1645"></script>
    <script>
        // Forcer le rechargement de game.html
        if (window.location.href.endsWith('game.html')) {
            window.location.reload(true);
        }
    </script>
    <script>
        const audio = document.getElementById('background-music');

        window.addEventListener('beforeunload', () => {
            sessionStorage.setItem('musicState', JSON.stringify({ isPlaying: !audio.paused, time: audio.currentTime }));
        });

        // When the page loads, check if music should be playing
        window.addEventListener('load', () => {
            const musicState = JSON.parse(sessionStorage.getItem('musicState'));
            if (musicState && musicState.isPlaying) {
                audio.currentTime = musicState.time || 0;
                audio.play().catch(e => console.log("Autoplay was prevented"));
            } else if (!musicState) {
                audio.addEventListener('loadedmetadata', () => {
                    audio.currentTime = Math.random() * audio.duration;
                    audio.play().catch(e => console.log("Autoplay was prevented"));
                }, { once: true });
            }
        });
    </script>
    <script src="js/device-check.js"></script>
</body>

</html>