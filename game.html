<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>Cas Clinique - MedGame</title>
    <link rel="icon" type="image/png" href="assets/images/icone.webp">
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/game.css">
    <link rel="manifest" href="manifest.json">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="stylesheet" href="css/nurse.css">
    <link rel="stylesheet" href="css/device-check.css">
    <!-- Ajout de Font Awesome pour les icônes -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/fireworks-js@latest/dist/fireworks.js"></script>
</head>

<body>

    <audio id="heartbeat-audio" src="assets/sounds/heartbeat.mp3" autoplay loop hidden>
        Votre navigateur ne prend pas en charge la music
    </audio>

    <script src="js/config.js"></script>
    <script>
        // Disable audio if MUSIC_ENABLED is 0
        if (typeof CONFIG !== 'undefined' && CONFIG.MUSIC_ENABLED === 0) {
            const audio = document.getElementById('heartbeat-audio');
            if (audio) audio.remove();
        }
    </script>

    <div class="app-container">
        <!-- Sidebar Toggle Button -->
        <button id="sidebar-toggle" class="sidebar-toggle" title="Afficher/Masquer le menu">
            <i class="fas fa-bars"></i>
        </button>
        <!-- SIDEBAR -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <a href="index.html" class="logo">
                    <i class="fas fa-user-md"></i> MEDGAME
                </a>
            </div>

            <!-- PATIENT MINI PROFILE (Optional, kept for quick ref) -->
            <div class="patient-mini-card">
                <div class="patient-avatar">
                    <span id="patient-initials">P</span>
                </div>
                <div class="patient-details">
                    <h3 id="patient-nom-sidebar">Patient</h3>
                    <p><span id="patient-age-sidebar">--</span> ans | <span id="patient-sexe-sidebar">--</span></p>
                </div>
            </div>

            <!-- NAVIGATION -->
            <nav class="sidebar-nav">
                <button class="nav-item active" data-target="section-anamnese">
                    <i class="fas fa-comments"></i> Anamnèse
                </button>
                <button class="nav-item" data-target="section-examen-clinique">
                    <i class="fas fa-stethoscope"></i> Examen Clinique
                </button>
                <button class="nav-item" data-target="section-examens">
                    <i class="fas fa-flask"></i> Examens Compl.
                </button>
                <button class="nav-item" data-target="section-synthese">
                    <i class="fas fa-check-circle"></i> Synthèse & Décision
                </button>
            </nav>

            <!-- SCOPE / VITAL MONITOR (Persistent) -->
            <div class="sidebar-scope" id="sidebar-scope">
                <!-- The JS will mount the VitalSignsMonitor here -->
                <!-- Hidden elements for JS to populate, used by the monitor -->
                <div id="vitals-data" style="display: none;">
                    <span id="tension"></span>
                    <span id="pouls"></span>
                    <span id="saturationO2"></span>
                    <span id="temperature"></span>
                    <span id="frequenceRespiratoire"></span>
                </div>
            </div>

            <div class="sidebar-footer">
                <div id="timer" class="timer-display">00:00</div>
                <a href="index.html" class="quit-btn">QUITTER</a>
            </div>
        </aside>

        <!-- MAIN CONTENT Area -->
        <main class="main-content">

            <header class="top-bar">
                <div class="case-info">
                    <span class="label">MOTIF D'ADMISSION</span>
                    <h2 id="motif-hospitalisation">Chargement...</h2>
                </div>
                <!-- Compact Vitals for Mobile -->
                <div id="compact-vitals" class="compact-vitals" onclick="window.toggleMobileMonitor()">
                    <div class="vitals-summary">
                        <span class="vitals-item"><i class="fas fa-heartbeat"></i> <span
                                id="compact-hr">--</span></span>
                        <span class="vitals-item"><i class="fas fa-tint"></i> <span id="compact-bp">--/--</span></span>
                        <span class="vitals-item"><i class="fas fa-thermometer-half"></i> <span
                                id="compact-temp">--</span></span>
                    </div>
                </div>
                <!-- Mobile Timer -->
                <div id="mobile-timer-container" class="mobile-timer">
                    <div id="mobile-timer" class="timer-display">00:00</div>
                </div>
            </header>

            <div class="content-scroll-area">

                <!-- SECTION: ANAMNÈSE -->
                <section id="section-anamnese" class="game-section active">
                    <h2 class="section-header">1. INTERROGATOIRE</h2>

                    <div id="patient-verbatim-container" class="verbatim-container">
                        <!-- Populated by JS -->
                    </div>

                    <div class="grid-layout">
                        <!-- Histoire de la Maladie -->
                        <div class="medical-card" id="histoire-maladie">
                            <h3 class="card-title">Histoire de la Maladie</h3>
                            <div class="card-content">
                                <!-- Mode de vie moved here -->
                                <div class="sub-section" id="mode-de-vie">
                                    <h4>Mode de vie</h4>
                                    <ul>
                                        <li>Tabac: <span id="tabac"></span></li>
                                        <li>Alcool: <span id="alcool"></span></li>
                                        <li>Métier: <span id="emploi"></span></li>
                                        <li>Activité: <span id="activite-physique"></span></li>
                                        <li>Alimentation: <span id="alimentation"></span></li>
                                    </ul>
                                </div>

                                <p><span class="label">Début :</span> <span id="debut-symptomes"></span></p>
                                <p><span class="label">Contexte :</span> <span id="facteurs-declenchants"></span></p>
                                <p><span class="label">Évolution :</span> <span id="evolution"></span></p>
                                <p><span class="label">Signes associés :</span> <span id="symptomes-associes"></span>
                                </p>
                                <div class="remarques-box">
                                    <i class="fas fa-pen"></i> <span id="remarques"></span>
                                </div>
                            </div>
                        </div>

                        <!-- Terrain & Antécédents -->
                        <div class="medical-card" id="antecedents">
                            <h3 class="card-title">Terrain & Antécédents</h3>
                            <div class="card-content">
                                <div class="sub-section">
                                    <h4>Antécédents</h4>
                                    <div id="antecedents-medicaux"></div>
                                    <div id="antecedents-chirurgicaux"></div>
                                    <div id="antecedents-familiaux"></div>
                                </div>

                                <div class="sub-section">
                                    <h4>Allergies / Traitements</h4>
                                    <p><span class="label">Allergies:</span> <span id="allergies-liste"></span></p>
                                    <p><span class="label">Tt habituel:</span> <span id="traitements-liste"></span></p>
                                </div>
                            </div>
                        </div>

                        <!-- Hidden Patient Info Fields required by JS -->
                        <div id="patient-info" style="display:none;">
                            <span id="patient-nom"></span>
                            <span id="patient-prenom"></span>
                            <span id="patient-age"></span>
                            <span id="patient-sexe"></span>
                            <span id="patient-taille"></span>
                            <span id="patient-poids"></span>
                            <span id="patient-groupeSanguin"></span>
                            <span id="aspectGeneral"></span>
                        </div>
                    </div>
                </section>

                <!-- SECTION: EXAMEN PHYSIQUE -->
                <section id="section-examen-clinique" class="game-section">
                    <h2 class="section-header">2. EXAMEN PHYSIQUE</h2>

                    <div class="grid-layout">
                        <div class="medical-card full-width" id="examen-clinique">
                            <!-- Note: Vitals are in sidebar. This contains only body exams. -->
                            <h3 class="card-title">Examen par appareil</h3>

                            <div class="exam-details-grid">
                                <!-- Dynamically populated by JS -->
                            </div>
                        </div>
                    </div>
                </section>

                <!-- SECTION: EXAMENS COMPLÉMENTAIRES -->
                <section id="section-examens" class="game-section">
                    <h2 class="section-header">3. EXAMENS COMPLÉMENTAIRES</h2>
                    <div class="medical-card full-width" id="examens">
                        <div class="exam-categories">
                            <!-- Populated by JS -->
                        </div>
                        <button id="validate-exams" class="action-btn">Demander les examens sélectionnés</button>
                        <div id="examens-results" class="exam-results-container"></div>
                    </div>
                </section>

                <!-- SECTION: SYNTHÈSE & DÉCISION -->
                <section id="section-synthese" class="game-section">
                    <h2 class="section-header">4. SYNTHÈSE & DÉCISION</h2>

                    <div class="grid-layout">
                        <div class="medical-card" id="diagnostic">
                            <h3 class="card-title">Diagnostic</h3>
                            <div class="form-group">
                                <label>Quelle est votre hypothèse principale ?</label>
                                <select id="diagnostic-select" class="modern-select">
                                    <option value="">Sélectionnez un diagnostic</option>
                                </select>
                            </div>
                            <!-- REMOVED validate-diagnostic button as requested -->
                            <p id="score" class="score-display"></p>
                            <p id="feedback" class="feedback-display"></p>
                            <p id="correctDiagnostic" class="hidden"></p>
                        </div>

                        <div class="medical-card">
                            <h3 class="card-title">Prescription & Prise en charge</h3>
                            <div id="availableTreatments" class="treatments-grid">
                                <!-- Populated by JS -->
                            </div>

                            <div class="action-area">
                                <button id="validate-traitement" class="validate-final-btn">
                                    <i class="fas fa-check-double"></i> VALIDER LE CAS
                                </button>
                            </div>
                            <p id="treatment-feedback" class="feedback-display"></p>
                        </div>
                    </div>
                </section>

            </div>
        </main>

        <!-- MOBILE TAB NAVIGATION -->
        <nav class="mobile-tabs">
            <button class="mobile-tab-item active" data-tab="anamnese">
                <i class="fas fa-comments"></i>
                <span>Anamnèse</span>
            </button>
            <button class="mobile-tab-item" data-tab="examen">
                <i class="fas fa-stethoscope"></i>
                <span>Examen</span>
            </button>
            <button class="mobile-tab-item" data-tab="exams">
                <i class="fas fa-flask"></i>
                <span>Exams</span>
            </button>
            <button class="mobile-tab-item" data-tab="decision">
                <i class="fas fa-check-circle"></i>
                <span>Décision</span>
            </button>
        </nav>
    </div>

    <!-- MOBILE MONITOR OVERLAY -->
    <div id="mobile-monitor-overlay" class="mobile-monitor-overlay">
        <div class="overlay-header">
            <h3>MONITEUR PATIENT</h3>
            <button class="close-overlay" onclick="window.toggleMobileMonitor()">&times;</button>
        </div>
        <div class="overlay-content">
            <div id="mobile-monitor-mount"></div>
        </div>
    </div>

    <div id="fireworks-container"></div>

    <!-- Correction Overlay -->
    <div id="correction-overlay" class="correction-overlay">
        <div id="correction-modal" class="correction-modal">
            <h2 class="correction-title">Correction du cas</h2>
            <div id="correction-content"></div>
            <button id="toggle-case-review" class="secondary-btn">Revoir le cas</button>
            <div id="case-review" class="case-review"></div>
            <div class="correction-actions">
                <button id="correction-back" class="secondary-btn">Retour</button>
                <button id="correction-next" class="primary-btn">Cas Suivant</button>
            </div>
        </div>
    </div>

    <!-- Image Overlay -->
    <div id="image-overlay" class="image-overlay" aria-hidden="true">
        <div id="image-modal" class="image-modal" role="dialog" aria-modal="true" aria-labelledby="image-modal-caption">
            <button id="image-modal-close" class="image-close" aria-label="Fermer l'image">&times;</button>
            <img id="image-modal-img" src="" alt="">
            <div id="image-modal-caption" class="image-caption"></div>
        </div>
    </div>

    <!-- Hidden Next Case Button for JS compatibility if needed, though we have one in correction modal -->
    <button id="next-case" style="display:none;">Cas Suivant</button>

    <script src="js/nurse.js"></script>
    <script src="js/game.js?v=20251220-1645"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.9.1/gsap.min.js"></script>
    <script src="js/device-check.js"></script>
</body>

</html>